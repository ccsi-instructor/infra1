

# Windows Serverでファイルサーバーを構築する
---

## シナリオ
この演習では、Windows Serverでファイルサーバーを構築する手順を学習します。   

"C:\Share" フォルダを作成し、クライアントからアクセス可能な共有フォルダとしてネットワークに公開します。  

公開するフォルダには、セキュリティ設定としてのアクセス許可が必要です。  
Windowsの共有フォルダのアクセス許可には、「共有アクセス許可」と「NTFSアクセス許可」の両方を設定します。  
今回の演習では、共有アクセス許可にはフルコントロールを設定し、NTFSアクセス許可で詳細を指定します。

共有フォルダにアクセスするユーザーアカウントは、WindowsローカルユーザーとしてWindows Serverで作成します。
"Tom"と"Jerry"の2つのユーザーアカウントを作成し、"File Server Users" グループに所属させます。

File Server Users グループに所属するJerryは共有フォルダのファイルに読み書きができます。  
Tomに対しては読みとり権限のみを与えて、書き込みを禁止します。  

ファイルサーバーの動作確認として、Clientから共有フォルダにアクセスしてファイルの読み書きをテストします。  


## 演習の意図
    演習ガイドを参照して演習の意図をあらかじめ確認してください
[ppt]
- aaa  


## 演習における役割と、環境のパラメータ
- X: ご自身のPod番号
- Windowsファイルサーバー役: WinSrv2(WSrv2-yyMMddX)
- クライアント デスクトップ環境: WinClient(WC1-yyMMddX)



## 注意
- 手順例の画像は<B>pod255</B>に準拠したパラメータのものです
- 手順内の<B>X</B>表記はご自身のpod番号に読み替えてください

---

## 1. Windowsファイルサーバー構築の準備
この演習では、Windows Server2(WinSrv2)をWindowsファイルサーバーとして構築します。  

1. Windowsファイルサーバー(WinSrv2)の管理画面に接続する  
1. [スタートメニュー]を右クリックし、コンテキストメニュー内の[Windows PowerShell(管理者)]をクリックする  
1. [ユーザー アカウント制御]のポップアップで[はい]をクリックする  
1. Windows PowerShellのウィンドウが表示されたことを確認する  
1. 以下のコマンドを実行し、Windowsファイルサーバー役のコンピュータ(WinSrv2)に接続していることを確認する  
    ＞ ***hostname***  
    
    > 【補足】  
    > Windowsファイルサーバー役のコンピュータであるWinSrv2には、"WSrv2-yyMMddX(年月日とPod番号)"形式のホスト名が設定されています。  

---

## 2. Windowsローカルユーザーアカウントの管理  
1. ローカルユーザー管理コンソールを起動する  
    1. [スタートメニュー]をクリックする  
    1. スタートメニュー内の[サーバー マネージャー]をクリックし、サーバーマネージャを起動する  
    1. サーバーマネージャーウィンドウ右上の[ツール]をクリックする  
    1. メニュー内の[コンピュータの管理]をクリックし、管理コンソールを起動する  
        <kbd>![img](image/05/14.png)</kbd>

1. ローカルユーザー(TomとJerry)を作成する  
    1. 左側コンソールツリーの[コンピュータの管理]-[システムツール]-[ローカル ユーザーとグループ]-[ユーザー]をクリックする  
    1. 左側コンソールツリーの[ユーザー]を右クリックし、コンテキストメニューの[新しいユーザー]をクリックする  
        <kbd>![img](image/05/15.png)</kbd>  
    1. [新しいユーザー]ウィンドウが表示されたことを確認する  
    1. 以下のパラメータを入力する

        | 項目 | パラメータ |
        | :----- | :----- |
        | ユーザー名 | Tom |
        | フル ネーム | <空欄> |
        | 説明 | <空欄> |  
        | パスワード | Pa$$w0rd |
        | パスワードの確認入力 | Pa$$w0rd |  

        - [ ] ユーザーは次回ログオン時にパスワードの変更が必要
        - [ ] ユーザーはパスワードの変更ができない
        - [x] パスワードを無期限にする
        - [ ] アカウントを無効にする
        <kbd>![img](image/05/15_2.png)</kbd> 
    1. 前項のパラメータを入力した後、[作成]ボタンをクリックする
    1. [閉じる]ボタンをクリックする
    1. 中央ペインのユーザーの一覧を参照し、"Tom" が作成されていることを確認する
        <kbd>![img](image/05/15_3.png)</kbd> 

    1. 左側コンソールツリーの[ユーザー]を右クリックし、コンテキストメニューの[新しいユーザー]をクリックする  
    1. [新しいユーザー]ウィンドウが表示されたことを確認する  
    1. 以下のパラメータを入力する

        | 項目 | パラメータ |
        | :----- | :----- |
        | ユーザー名 | Jerry |
        | フル ネーム | <空欄> |
        | 説明 | <空欄> |  
        | パスワード | Pa$$w0rd |
        | パスワードの確認入力 | Pa$$w0rd |  

        - [ ] ユーザーは次回ログオン時にパスワードの変更が必要
        - [ ] ユーザーはパスワードの変更ができない
        - [x] パスワードを無期限にする
        - [ ] アカウントを無効にする
        <kbd>![img](image/05/15_4.png)</kbd> 
    1. 前項のパラメータを入力した後、[作成]ボタンをクリックする
    1. [閉じる]ボタンをクリックする
    1. 中央ペインのユーザーの一覧を参照し、"Jerry" が作成されていることを確認する
        <kbd>![img](image/05/15_5.png)</kbd> 


1. ローカルグループ(File Server Users)を作成する  
    1. 左側コンソールツリーの[コンピュータの管理]-[システムツール]-[ローカル ユーザーとグループ]-[グループ]をクリックする  
    1. 左側コンソールツリーの[グループ]を右クリックし、コンテキストメニューの[新しいグループ]をクリックする  
        <kbd>![img](image/05/16.png)</kbd> 
    1. [新しいグループ]ウィンドウが表示されたことを確認する  
        <kbd>![img](image/05/17.png)</kbd> 
    1. 以下のパラメータを入力する  

        | 項目 | パラメータ |
        | :----- | :----- |
        | グループ名 | File Server Users |
        | 所属するメンバー | <空欄> |

    1. 前項のパラメータを入力した後、[作成]ボタンをクリックする  
    1. [閉じる]ボタンをクリックする  
    1. 中央ペインのグループの一覧を参照し、"File Server Users" が作成されていることを確認する  
        <kbd>![img](image/05/19.png)</kbd> 

1. ローカルグループ(File Server Users)にユーザー(Jerry)を所属させる  
    1. 中央ペインのグループの一覧を参照し、[File Server Users]をクリックする  
    1. [File Server Users]を右クリックし、コンテキストメニューの[プロパティ]をクリックする  
        <kbd>![img](image/05/20.png)</kbd> 
    1. 所属するメンバー欄の下の[追加]をクリックする  
        <kbd>![img](image/05/21.png)</kbd> 
    1. [ユーザーの選択]ウィンドウが表示されたことを確認する  
        <kbd>![img](image/05/22.png)</kbd> 
    1. "選択するオブジェクト名を入力してください" の欄に "Jerry" と入力する  
        <kbd>![img](image/05/23.png)</kbd> 
    1. [名前の確認]をクリックする  
    1. "<コンピュータ名>￥Jerry" の表記に下線がついたことを確認する  
        <kbd>![img](image/05/24.png)</kbd> 
    1. [OK]をクリックする  
    1. [新しいグループ]ウィンドウの "所属するメンバー" に "Jerry" が表示されていることを確認する
        <kbd>![img](image/05/25.png)</kbd> 
    1. [OK]をクリックする  

1. ローカルグループ(File Server Users)にユーザー(Tom)を所属させる  
    1. 中央ペインのグループの一覧を参照し、[File Server Users]をクリックする  
    1. [File Server Users]を右クリックし、コンテキストメニューの[プロパティ]をクリックする  
    1. 所属するメンバー欄の下の[追加]をクリックする  
    1. [ユーザーの選択]ウィンドウが表示されたことを確認する  
    1. "選択するオブジェクト名を入力してください" の欄に "Tom" と入力する  
    1. [名前の確認]をクリックする  
    1. "<コンピュータ名>￥Tom" の表記に下線がついたことを確認する  
    1. [OK]をクリックする  
    1. [新しいグループ]ウィンドウの "所属するメンバー" に "Tom" が表示されていることを確認する
    1. [OK]をクリックする  


---

## 3. フォルダ(C:\Share)を共有する  
この手順では、ファイルサーバーのデータを保存するフォルダ(C:\Share)を作成し、共有フォルダとしてネットワークに公開します。  

1. C:\Shareフォルダを作成する   
    1. ファイル エクスプローラーを起動する   
    1. Cドライブ直下にアクセスする  
    1. 右クリック コンテキストメニューの[新規作成]-[フォルダー]をクリックする
        <kbd>![img](image/05/31.png)</kbd> 
    1. 作成された新しいフォルダの名前を "Share" に変更する  
        <kbd>![img](image/05/32.png)</kbd> 

1. フォルダをネットワークに公開し、共有アクセス許可を設定する
    1. [Share]フォルダをクリックし、右クリック コンテキストメニューの[プロパティ]をクリックする
    1. [プロパティ]ウィンドウの[共有]タブをクリックする
    1. [詳細な共有] をクリックする
        <kbd>![img](image/05/33.png)</kbd> 
    1. 以下のパラメータを入力する

        - [x] このフォルダーを共有する

        | 項目 | パラメータ |
        | :----- | :----- |
        | 共有名 | Share |
        | 同時共有できるユーザー数 | 1677721 |
        | コメント| <空欄> |
    
        <kbd>![img](image/05/35.png)</kbd> 

    1. [アクセス許可] をクリックする  
    1. [Shareのアクセス許可]ウィンドウが表示されたのを確認する  
        <kbd>![img](image/05/37.png)</kbd> 
    1. [Everyone]をクリックして選択し、[フルコントロール]の "許可" にチェックをつける  
        <kbd>![img](image/05/38.png)</kbd> 
    1. [Shareのアクセス許可]ウィンドウで、[OK]をクリックする  
    1. [詳細な共有]ウィンドウで、[OK]をクリックする  
        <kbd>![img](image/05/39.png)</kbd> 
    1. [プロパティ]ウィンドウで、[閉じる]をクリックする  
        <kbd>![img](image/05/40.png)</kbd>

1. 共有フォルダのステータスを確認する  
    1. PowerShellを起動する  
    1. 以下のコマンドを実行し、C:¥Shareフォルダが "Share" という共有名でネットワークに公開されていることを確認する  
        ＞ ***net share***  
    
        <kbd>![img](image/05/41.png)</kbd>


---

## 4. NTFSアクセス許可を設定する  

1. C:\Shareフォルダの[セキュリティ]タブを開く   
    1. [Share]フォルダをクリックし、右クリック コンテキストメニューの[プロパティ]をクリックする  
    1. [プロパティ]ウィンドウの[セキュリティ]タブをクリックする  
        <kbd>![img](image/05/51.png)</kbd>

1. "File Server Users"グループに読み書きの許可を与える  
    1. [編集]をクリックする  
    1. [Shareのアクセス許可]ウィンドウが表示されたことを確認する  
        <kbd>![img](image/05/52.png)</kbd>  
    1. [追加]をクリックする  
    1. [ユーザーまたはグループの選択]ウィンドウが表示されたことを確認する  
        <kbd>![img](image/05/53.png)</kbd>
    1. "選択するオブジェクト名を入力してください" の欄に "File Server Users" と入力する  
    1. [名前の確認]をクリックする  
    1. "<コンピュータ名>￥File Server Users" の表記に下線がついたことを確認する  
        <kbd>![img](image/05/54.png)</kbd> 
    1. [OK]をクリックする  
    1. [Shareのアクセス許可]ウィンドウで、"File Server Users"が追加されていることを確認する  
    1. [File Server Users]をクリックして選択する  
        <kbd>![img](image/05/55.png)</kbd> 
    1. [Shareのアクセス許可]ウィンドウ下部の "アクセス許可" を参照し、"変更" の "許可" にチェックをつける  
        <kbd>![img](image/05/56.png)</kbd> 
    1. [Shareのアクセス許可]ウィンドウで、[OK]をクリックする  
    1. [プロパティ]ウィンドウで、"File Server Users"が追加されていることを確認する  
        <kbd>![img](image/05/57.png)</kbd> 

1. ユーザー "Tom" の書き込みを禁止する  
    1. [プロパティ]ウィンドウの[セキュリティ]タブで、[編集]をクリックする  
    1. [Shareのアクセス許可]ウィンドウが表示されたことを確認する  
    1. [追加]をクリックする  
    1. [ユーザーまたはグループの選択]ウィンドウが表示されたことを確認する  
    1. "選択するオブジェクト名を入力してください" の欄に "Tom" と入力する  
    1. [名前の確認]をクリックする  
    1. "<コンピュータ名>￥Tom" の表記に下線がついたことを確認する  
    1. [OK]をクリックする  
    1. [Shareのアクセス許可]ウィンドウで、"Tom" が追加されていることを確認する  
    1. [Tom]をクリックして選択する  
    1. [Shareのアクセス許可]ウィンドウ下部の "アクセス許可" を参照し、"書き込み" の "禁止" にチェックをつける  
        <kbd>![img](image/05/61.png)</kbd> 
    1. [Shareのアクセス許可]ウィンドウで、[OK]をクリックする  
    1. 警告の[Windowsセキュリティ]ウィンドウで、[はい]をクリックする  
        <kbd>![img](image/05/62.png)</kbd>   
    1. [プロパティ]ウィンドウで、"Tom"が追加されていることを確認する  
        <kbd>![img](image/05/63.png)</kbd>   
    1. [プロパティ]ウィンドウで、[OK]をクリックする   

---

## 5. Windowsファイルサーバーの動作を確認する


この演習では、WinClient(WC1)をクライアント デスクトップ環境と想定して、ファイルサーバーの動作確認に使用します。  
ファイルサーバーとクライアントデスクトップはワークグループ環境であるため、クライアントからファイルサーバーにアクセスするためには、それぞれのコンピュータに同じユーザー アカウントを作成する必要があります。  

1. Windows Clientに"admin"で接続する  
    1. Windows Client(WinClient)の管理画面に "admin" で接続する 
        <kbd>![img](image/05/71.png)</kbd>   
    1. [スタートメニュー]を右クリックし、コンテキストメニュー内の[Windows PowerShell(管理者)]をクリックする  
    1. [ユーザー アカウント制御]のポップアップで[はい]をクリックする  
    1. Windows PowerShellのウィンドウが表示されたことを確認する  
    1. 以下のコマンドを実行し、クライアント デスクトップ環境役のコンピュータ(WC1)に "admin" で接続していることを確認する  
        ＞ ***hostname***  
        ＞ ***whoami***         
        > 【補足】  
        > クライアント デスクトップ環境役のコンピュータであるWinClientは、"WC1-yyMMddX(年月日とPod番号)"形式のホスト名が設定されています。  
        <kbd>![img](image/05/72.png)</kbd>   

1. Windows Clientにローカルユーザー(TomとJerry)を作成する  
    1. Windows PowerShellで以下のコマンドを実行し、[ローカルユーザーとグループ]管理コンソールを起動する  
        ＞ ***lusrmgr.msc***  
        <kbd>![img](image/05/73.png)</kbd>   
        <kbd>![img](image/05/74.png)</kbd>   

    1. 左側コンソールツリーの[ローカル ユーザーとグループ]-[ユーザー]をクリックする  
    1. 左側コンソールツリーの[ユーザー]を右クリックし、コンテキストメニューの[新しいユーザー]をクリックする  
    1. [新しいユーザー]ウィンドウが表示されたことを確認する  
    1. 以下のパラメータを入力する

        | 項目 | パラメータ |
        | :----- | :----- |
        | ユーザー名 | Tom |
        | フル ネーム | <空欄> |
        | 説明 | <空欄> |  
        | パスワード | Pa$$w0rd |
        | パスワードの確認入力 | Pa$$w0rd |  

        - [ ] ユーザーは次回ログオン時にパスワードの変更が必要
        - [ ] ユーザーはパスワードの変更ができない
        - [x] パスワードを無期限にする
        - [ ] アカウントを無効にする
        <kbd>![img](image/05/15_2.png)</kbd> 
    1. 前項のパラメータを入力した後、[作成]ボタンをクリックする
    1. [閉じる]ボタンをクリックする
    1. 中央ペインのユーザーの一覧を参照し、"Tom" が作成されていることを確認する

    1. 左側コンソールツリーの[ユーザー]を右クリックし、コンテキストメニューの[新しいユーザー]をクリックする  
    1. [新しいユーザー]ウィンドウが表示されたことを確認する  
    1. 以下のパラメータを入力する

        | 項目 | パラメータ |
        | :----- | :----- |
        | ユーザー名 | Jerry |
        | フル ネーム | <空欄> |
        | 説明 | <空欄> |  
        | パスワード | Pa$$w0rd |
        | パスワードの確認入力 | Pa$$w0rd |  

        - [ ] ユーザーは次回ログオン時にパスワードの変更が必要
        - [ ] ユーザーはパスワードの変更ができない
        - [x] パスワードを無期限にする
        - [ ] アカウントを無効にする
    1. 前項のパラメータを入力した後、[作成]ボタンをクリックする
    1. [閉じる]ボタンをクリックする
    1. 中央ペインのユーザーの一覧を参照し、"Jerry" が作成されていることを確認する
        <kbd>![img](image/05/75.png)</kbd> 


1. ローカルユーザーの管理接続(リモートデスクトップ)を許可する
演習環境の管理接続には、リモートデスクトップのテクノロジーが利用されています。  
TomとJerryで管理接続をするためには、リモートデスクトップの許可が必要です。  
Windowsにはリモートデスクトップ接続を許可するためのローカル セキュリティグループ(Remote Desktop Users)が用意されています。  
TomとJerryをこのグループに所属させます。  

    1. [ローカルユーザーとグループ]管理コンソールで、左側コンソールツリーの[ローカル ユーザーとグループ]-[グループ]をクリックする
    1. 中央ペインのユーザーの一覧を参照し、[Remote Desktop Users]をクリックして選択する
    1. 右クリック コンテキストメニューの[プロパティ]をクリックする
        <kbd>![img](image/05/76.png)</kbd> 
    1. [プロパティ]ウィンドウで、[追加]をクリックする
        <kbd>![img](image/05/77.png)</kbd> 
    1. [ユーザーの選択]ウィンドウが表示されたことを確認する  
    1. "選択するオブジェクト名を入力してください" の欄に "Tom" と入力する  
    1. [名前の確認]をクリックする  
    1. "<コンピュータ名>￥Tom" の表記に下線がついたことを確認する  
    1. [OK]をクリックする  
    1. [プロパティ]ウィンドウの "所属するメンバー" に "Tom" が表示されていることを確認する
    1. [プロパティ]ウィンドウで、[追加]をクリックする
    1. [ユーザーの選択]ウィンドウが表示されたことを確認する  
    1. "選択するオブジェクト名を入力してください" の欄に "Jerry" と入力する  
    1. [名前の確認]をクリックする  
    1. "<コンピュータ名>￥Jerry" の表記に下線がついたことを確認する  
    1. [OK]をクリックする  
    1. [プロパティ]ウィンドウの "所属するメンバー" に "Jerry" が表示されていることを確認する
    1. [プロパティ]ウィンドウで、[OK]をクリックする  
        <kbd>![img](image/05/78.png)</kbd> 
    1. [ローカルユーザーとグループ]管理コンソールを終了します。



1. Windows Clientに"Jerry"で接続する  
    1. Windows Client(WinClient)の管理画面に "Jerry" で接続する('Local Jerry'と'AD Jerry'がある場合は'Local Jerry'を使用する)  
        <kbd>![img](image/05/81.png)</kbd>   
    1. [スタートメニュー]を右クリックし、コンテキストメニュー内の[Windows PowerShell]をクリックする('管理者'ではなく通常のPowerShellを起動する)  
    1. [ユーザー アカウント制御]のポップアップで[はい]をクリックする  
    1. Windows PowerShellのウィンドウが表示されたことを確認する  
    1. 以下のコマンドを実行し、クライアント デスクトップ環境役のコンピュータ(WC1)に "Jerry" で接続していることを確認する  
        ＞ ***hostname***  
        ＞ ***whoami***         
        <kbd>![img](image/05/82.png)</kbd>  
 
1. Jerryでファイルサーバーにアクセスする  
    1. ファイルエクスプローラを起動し、アドレス欄ファイルサーバーのUNCパス(\\\\10.X.2.105\\Share)を入力してEnterキーを押下する     
        <kbd>![img](image/05/83.png)</kbd>   
        > 【補足】  
        > UNCパスは、ファイルサーバーのアクセス時に使用するアドレス情報です。   
        > \\\\<サーバー名>\\<共有名>  
        > の様式で、ネットワーク上の共有フォルダを指定できます。  
    1. ファイルサーバーのShareフォルダにアクセスできることを確認する  
        <kbd>![img](image/05/84.png)</kbd> 
    1. Jerryでファイルサーバーの動作テストを実行する  
        > 【動作テストの観点】  
        > JerryはShareフォルダでファイルの読み書きができることを確認する  

        - [x] Shareフォルダに任意の名称のテキストファイルを作成できること  
        - [x] 作成したテキストファイルを開き、任意の文言を記入してファイルを保存できること  
        - [x] 保存されたファイルを開き、テキストファイルの中身を閲覧できること  
        <kbd>![img](image/05/86.png)</kbd> 
        <kbd>![img](image/05/87.png)</kbd> 

1. Windows Clientに"Tom"で接続する  
    1. Windows Client(WinClient)の管理画面に "Tom" で接続する('Local Tom'と'AD Tom'がある場合は'Local Tom'を使用する)  
        <kbd>![img](image/05/88.png)</kbd> 
    1. [スタートメニュー]を右クリックし、コンテキストメニュー内の[Windows PowerShell]をクリックする('管理者'ではなく通常のPowerShellを起動する)  
    1. [ユーザー アカウント制御]のポップアップで[はい]をクリックする  
    1. Windows PowerShellのウィンドウが表示されたことを確認する  
    1. 以下のコマンドを実行し、クライアント デスクトップ環境役のコンピュータ(WC1)に "Tom" で接続していることを確認する  
        ＞ ***hostname***  
        ＞ ***whoami***         

1. Tomでファイルサーバーにアクセスする  
    1. ファイルエクスプローラを起動し、アドレス欄ファイルサーバーのUNCパス(\\\\10.X.2.105\\Share)を入力してEnterキーを押下する            
    1. ファイルサーバーのShareフォルダにアクセスできることを確認する  
        <kbd>![img](image/05/89.png)</kbd> 
    1. Tomでファイルサーバーの動作テストを実行する  
        > 【動作テストの観点】  
        > TomはShareフォルダで、ファイルの読み取りはできるが、書き込みはできないことを確認する  

        - [x] Shareフォルダに新しいファイルを作成できないこと
        - [x] Jerryが作成したファイルの中身を閲覧できること 
        - [x] テキストファイルに任意の文言を記入してファイルを上書き保存しようとすると、アクセス権がない旨の警告が表示されること  
        <kbd>![img](image/05/94.png)</kbd> 
        <kbd>![img](image/05/95.png)</kbd> 
        <kbd>![img](image/05/89.png)</kbd> 
        <kbd>![img](image/05/91.png)</kbd> 
        <kbd>![img](image/05/92.png)</kbd> 
        <kbd>![img](image/05/93.png)</kbd> 

---

## 演習完了  
ここまでの手順で、以下の項目を学習できました。
- [x] Windowsワークグループ環境で使用するローカルユーザーを作成する  
- グルぷ
- [x] 共有フォルダを作成してネットワークに公開する  
- [x] 共有フォルダに、共有アクセス権とNTFSアクセス権を設定する
- [x] NTFSアクセス権として、ファイルの読み書きの許可や禁止を設定する  

- [x] Jerryが作成したファイルの中身を閲覧できること 
- [x] テキストファイルに任意の文言を記入してファイルを上書き保存しようとすると、アクセス権がない旨の警告が表示されること  
