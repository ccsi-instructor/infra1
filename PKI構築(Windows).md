

# Windows ServerでPKI環境を構築する

---

## 演習の意図
    演習ガイドを参照して演習の意図をあらかじめ確認してください

## 演習における役割と、環境のパラメータ
- X: ご自身のPod番号  
- 認証局(証明書サーバー)役: WinSrv1(WSrv1-yyMMddX)  
- HTTPS Webサーバー役: WinSrv2(WSrv2-yyMMddX)
- クライアント デスクトップ環境: WinClient(WC1-yyMMddX)  

## 注意
- 手順例の画像は<B>pod255</B>に準拠したパラメータのものです
- 手順内の<B>X</B>表記はご自身のpod番号に読み替えてください

---

## 認証局の役割を追加する  
## 証明書要求を作成する  
## 発行する  
## 割り当てる  
## 警告が表示される
## (オプション)GPOで配布する


---

## Active Directory証明書サービスの役割を追加  
1. Windows 認証局(WinSrv1)の管理画面に接続する  

1. 役割と機能の追加ウィザードを開始する  
    1. [スタートメニュー]をクリックする  
    1. スタートメニュー内の[サーバー マネージャー]をクリックし、サーバーマネージャを起動する    
    1. サーバーマネージャーのダッシュボード画面内の[役割と機能の追加]をクリックする   
    1. [役割と機能の追加ウィザード]ウィンドウが起動したことを確認する  

1. Active Directory証明書サービスの役割を追加する
    1. [役割と機能の追加ウィザード]ウィンドウの[開始する前に]画面で、[次へ]をクリックする  
    1. [インストールの種類]画面で、[次へ]をクリックする  
    1. [サーバーの選択]画面で、[次へ]をクリックする  
    1. [サーバーの役割]画面で、以下のパラメータを選択する  

        - [x] Active Directory証明書サービス   
    
        > 【補足】  
        > "Active Directory証明書サービス"のチェックをつけると、[Active Directory証明書サービスに必要な機能を追加しますか？]の確認ポップアップが表示されます。  
        > [Active Directory証明書サービスに必要な機能を追加しますか？]ウィンドウで、[機能の追加] をクリックします。  

        <kbd>![img](image/17/11.png)</kbd>  

    1. [サーバーの役割]画面で、上のパラメータを選択したことを確認し、[次へ]をクリックする  
    1. [機能の選択]画面で、[次へ]をクリックする  
    1. [AD CS]画面で、[次へ]をクリックする   
    1. [役割サービス]画面で、以下のパラメータを選択する  

        - [x] 証明機関
        - [ ] オンラインレスポンダー
        - [ ] ネットワークデバイス登録サービス  
        - [x] 証明機関Web登録
        - [ ] 証明書の登録Webサービス  
        - [ ] 証明書の登録ポリシーWebサービス   

        > 【補足】  
        > "証明機関Web登録"のチェックをつけると、[証明機関Web登録 に必要な機能を追加しますか？]の確認ポップアップが表示されます。  
        > [証明機関Web登録 に必要な機能を追加しますか？]ウィンドウで、[機能の追加] をクリックします。  

    1. [役割サービス]画面で、[次へ]をクリックする  
    1. [Webサーバーの役割(IIS)]画面で、[次へ]をクリックする  
    1. [役割サービスの選択]画面で、[次へ]をクリックする  
        <kbd>![img](image/17/12.png)</kbd>  
    1. [確認]画面で、[インストール]をクリックする  
    1. [結果]画面で、インストール進捗を示すプログレスバーが右端に到達するまで数分間待機する  
    1. [結果]画面で、インストールが正常に完了したことを確認し、[閉じる]をクリックする  
        <kbd>![img](image/17/13.png)</kbd> 


## Active Directory証明書サービスを構成する   
1. Windows 認証局(WinSrv1)の管理画面に接続する  

1. Active Directory証明書サービス構成ウィザードを開始する  
    1. サーバーマネージャを起動する    
    1. サーバーマネージャーのダッシュボード画面上部の通知アイコンをクリックし、"展開後構成"の[対象サーバーにActive Directory証明書サービスを構成する]をクリックする  
        <kbd>![img](image/17/14.png)</kbd>      
    1. [AD CSの構成]ウィンドウが起動したことを確認する  
        <kbd>![img](image/17/15.png)</kbd>  

1. AD CS(Active Directory証明書サービス)を構成する    

    1. [AD CS構成]ウィンドウの[資格情報]画面で、[次へ]をクリックする  
    1. [AD CS構成]ウィンドウの[役割サービス]画面で、以下のパラメータを選択する   

        構成する役割サービスの選択:  
        - [x] 証明機関  
        - [x] 証明機関Web登録
        - [ ] オンラインレスポンダー
        - [ ] ネットワークデバイス登録サービス
        - [ ] 証明書の登録Webサービス  
        - [ ] 証明書の登録ポリシーWebサービス   

        <kbd>![img](image/17/16.png)</kbd>  

    1. [AD CS構成]ウィンドウの[役割サービス]画面で、[次へ]をクリックする    

    1. [AD CS構成]ウィンドウの[セットアップの種類]画面で、以下のパラメータを選択する   
        
        - [ ] エンタープライズCA
        - [x] スタンドアロンCA  

        <kbd>![img](image/17/17.png)</kbd>  

    1. [AD CS構成]ウィンドウの[セットアップの種類]画面で、[次へ]をクリックする    

    1. [AD CS構成]ウィンドウの[CAの種類]画面で、以下のパラメータを選択する   
        
        - [x] ルートCA
        - [ ] 下位CA   

        <kbd>![img](image/17/18.png)</kbd>  

    1. [AD CS構成]ウィンドウの[CAの種類]画面で、[次へ]をクリックする    

    1. [AD CS構成]ウィンドウの[秘密キー]画面で、以下のパラメータを選択する   
        
        - [x] 新しい秘密キーを作成する
        - [ ] 既存の秘密キーを使用する     
            - [ ] 証明書を選択し、関連付けられている秘密キーを使用する       
            - [ ] このコンピューターの既存の秘密キーを選択する       

        <kbd>![img](image/17/19.png)</kbd>  

    1. [AD CS構成]ウィンドウの[秘密キー]画面で、[次へ]をクリックする    

    1. [AD CS構成]ウィンドウの[暗号化]画面で、以下のパラメータを選択する   
        
        暗号化プロバイダーの選択:  
        | RSA#Microsoft Software Key Storage Privoder | 
        | :----- | 

        キー長の選択:  
        | 2048 | 
        | :----- | 

        このCAから発行された証明書の署名に使用するハッシュアルゴリズムを選択:  
        | SHA256 | 
        | :----- | 

        - [ ] CAが秘密キーにアクセスするときに、管理者による操作を許可する       
   

        <kbd>![img](image/17/20.png)</kbd>  

    1. [AD CS構成]ウィンドウの[暗号化]画面で、[次へ]をクリックする    

    1. [AD CS構成]ウィンドウの[CAの名前]画面で、以下のパラメータを入力する   
        
        このCAの共通名:  
        | WinCA | 
        | :----- | 

        識別名のサフィックス:  
        | DC=example, DC=local | 
        | :----- | 

        識別名のプレビュー:  
        | CN=WinCA, DC=example, DC=local | 
        | :----- | 
   

        <kbd>![img](image/17/22.png)</kbd>  

    1. [AD CS構成]ウィンドウの[CAの名前]画面で、[次へ]をクリックする    

    1. [AD CS構成]ウィンドウの[有効期間]画面で、以下のパラメータを入力する   
        
        この証明機関(CA)に対して生成される証明書の有効期間を選択:  
        | 5 年間 | 
        | :----- | 

        <kbd>![img](image/17/23.png)</kbd>  

    1. [AD CS構成]ウィンドウの[有効期間]画面で、[次へ]をクリックする    

    1. [AD CS構成]ウィンドウの[CAデータベース]画面で、以下のパラメータを入力する   
        
        証明書データベースの場所:   
        | C:\\Windows\\system32\\CertLog | 
        | :----- | 

        証明書データベースのログの場所:   
        | C:\\Windows\\system32\\CertLog | 
        | :----- | 

        <kbd>![img](image/17/24.png)</kbd>  

    1. [AD CS構成]ウィンドウの[CAデータベース]画面で、[次へ]をクリックする    

    1. [AD CS構成]ウィンドウの[確認]画面で、[構成]をクリックする  
         <kbd>![img](image/17/25.png)</kbd>         

    1. [AD CS構成]ウィンドウの[結果]画面で、[閉じる]をクリックする  
         <kbd>![img](image/17/26.png)</kbd>         


## Active Directory証明書サービスを構成後の確認   

1. Windows 認証局(WinSrv1)の管理画面に接続する  

1. 証明機関管理コンソールを起動できることを確認する    
    1. サーバーマネージャーウィンドウ右上の[ツール]をクリックする  
    1. メニュー内の[証明機関]をクリックし、証明機関管理コンソールを起動する  
        <kbd>![img](image/17/27.png)</kbd> 
    1. [証明機関]管理コンソールが起動したことを確認する
        <kbd>![img](image/17/28.png)</kbd> 

1. 認証局としての自己署名証明書(ルート証明書)が作成されていることを確認する  
    1. [証明書]管理コンソールを起動する
        1. Windows スタートメニューを右クリックし、コンテキストメニュー内の[ファイル名を指定して実行]をクリックする  
        1. [ファイル名を指定して実行]ウィンドウが起動したことを確認する  
        1. [ファイル名を指定して実行]ウィンドウで、以下のパラメータを入力する  

            名前:   
            | certlm.msc | 
            | :----- | 

            <kbd>![img](image/17/29.png)</kbd> 

        1. [ファイル名を指定して実行]ウィンドウで、[OK]をクリックする    

        1. [ユーザーアカウント制御]のポップアップで、[はい]をクリックする  

        1. [証明書]管理コンソールが起動したことを確認する  

            <kbd>![img](image/17/30.png)</kbd>  

    1. Windows Server 2が所有している電子証明書を確認する          
        1. 左側コンソールツリーの[証明書 - ローカル コンピューター]-[個人]-[証明書]をクリックする  
            <kbd>![img](image/17/31.png)</kbd>  
        1. ウィンドウ右側ペインの証明書の一覧を参照し、発行者が "WinCA" である証明書をクリックして選択する  
        1. "WinCA" の証明書を右クリックし、コンテキストメニュー内の[開く]をクリックする    
            <kbd>![img](image/17/32.png)</kbd>  
        1. [証明書]ウィンドウが表示されたことを確認する  
            <kbd>![img](image/17/33.png)</kbd>  
    
    1. 証明書のパラメータを確認する   

        1. [証明書]ウィンドウの[全般]タブに記載されているパラメータを確認する  

            > 【確認ポイント】  
            > - [x] 発行先 が "WinCA" であること   
            > - [x] 発行元 が "WinCA" であること    
            > - [x] "この証明書に対応する秘密キーを持っています"と表記されていうこと  

        1. [証明書]ウィンドウの[詳細]タブに記載されているパラメータを確認する  

            > 【確認ポイント】  
            > - [x] 有効期間の開始 が 現在日時よりも前であること   
            > - [x] 有効期間の終了 が 現在日時よりも後であること   
            > - [x] 発行者 が "WinCA, example, local" であること   
            > - [x] サブジェクト が "WinCA, example, local" であること   
            
            <kbd>![img](image/17/34.png)</kbd>  
    
        1. [証明書]ウィンドウの[照明のパス]タブに記載されているパラメータを確認する  

            > 【確認ポイント】  
            > - [x] "WinCA"の"証明書の状態"が "この証明書は問題ありません。" であること  

            <kbd>![img](image/17/35.png)</kbd>  

1. 証明機関Web登録サービスが起動していることを確認する  

    1. IIS管理コンソールを起動する  
        1. サーバーマネージャーウィンドウ右上の[ツール]をクリックする  
        1. メニュー内の[インターネット インフォメーション サービス(IIS) マネージャー]をクリックし、IIS管理コンソールを起動する  
        1. [インターネット インフォメーション サービス(IIS) マネージャー]が起動したことを確認する  
    
    1. CertSrvアプリケーションが動作していることを確認する  
        1. 左側コンソールツリーの[＜サーバー名＞]-[サイト]-[Default Web Site]-[CertSrv]をクリックする          
        1. ウィンドウ右側ペインの[アプリケーションの管理]メニューの[*:80(http)参照]をクリックする  
            <kbd>![img](image/17/36.png)</kbd>  
        1. Webブラウザ(Microsoft Edge)が起動したことを確認する  

    1. 証明機関Web登録サービスのWebアプリケーションにアクセスできることを確認する  
            <kbd>![img](image/17/37.png)</kbd>  

---  

## Window Server 2で証明書署名要求(CSR)を作成する  

1. HTTPS Webサーバー(WinSrv2)の管理画面に接続する  

1. [証明書]管理コンソールを起動する
    1. Windows スタートメニューを右クリックし、コンテキストメニュー内の[ファイル名を指定して実行]をクリックする  
    1. [ファイル名を指定して実行]ウィンドウが起動したことを確認する  
    1. [ファイル名を指定して実行]ウィンドウで、以下のパラメータを入力する  

        名前:   
        | certlm.msc | 
        | :----- | 

    1. [ファイル名を指定して実行]ウィンドウで、[OK]をクリックする    
    1. [ユーザーアカウント制御]のポップアップで、[はい]をクリックする  
    1. [証明書]管理コンソールが起動したことを確認する  

1. カスタム要求の作成ウィザードを起動する  
    1. 左側コンソールツリーの[証明書 - ローカル コンピューター]-[個人]-[証明書]をクリックする  
    1. 左側コンソールツリーの[証明書 - ローカル コンピューター]-[個人]-[証明書]を右クリックし、コンテキストメニュー内の[すべてのタスク]-[詳細設定操作]-[カスタム要求の作成]をクリックする  
        <kbd>![img](image/17/41.png)</kbd> 
    1. [証明書の登録]ウィンドウが表示されたことを確認する  
        <kbd>![img](image/17/42.png)</kbd> 

1. カスタム要求を作成する  
    1. [証明書の登録]ウィンドウの[開始する前に]画面で、[次へ]をクリックする  
        <kbd>![img](image/17/42.png)</kbd> 
    1. [証明書の登録]ウィンドウの[証明書の登録ポリシーの選択]画面で、[次へ]をクリックする  
        <kbd>![img](image/17/43.png)</kbd> 
    1. [証明書の登録]ウィンドウの[カスタム要求]画面で、[次へ]をクリックする  
        <kbd>![img](image/17/44.png)</kbd> 
    1. [証明書の登録]ウィンドウの[証明書情報]画面で、[詳細]の展開ボタンをクリックする  
    1. [証明書の登録]ウィンドウの[証明書情報]画面で、[プロパティ]をクリックする  
        <kbd>![img](image/17/45.png)</kbd> 
    1. [証明書のプロパティ]ウィンドウが表示されたことを確認する    
        <kbd>![img](image/17/46.png)</kbd> 

    1. [証明書のプロパティ]ウィンドウの[全般]タブで、以下のパラメータを入力する     

        フレンドリ名:   
        | HttpsCert | 
        | :----- | 

        説明:   
        | <空欄> | 

        <kbd>![img](image/17/47.png)</kbd> 

    1. [証明書のプロパティ]ウィンドウの[全般]タブで、[適用]をクリックする      
    1. [証明書のプロパティ]ウィンドウの[サブジェクト]タブをクリックして選択する  
        <kbd>![img](image/17/48.png)</kbd>  

    1. [証明書のプロパティ]ウィンドウの[サブジェクト]タブで、以下のパラメータを入力する     

        共通名:   
        | CN=WinSrv2.example.local |     
        | :----- | 

        別名:   
        | DNS | 
        | :----- | 
        | Web1.example.local |

        | IPアドレス(v4) | 
        | :----- | 
        | 10.X.2.105 |

        <kbd>![img](image/17/49.png)</kbd> 

        詳細手順:  

        1. "サブジェクト名" の "種類" で、 "共通名" を選択する  
        1. "サブジェクト名" の "値" に、"WinSrv2.example.local" を入力する
        1. "サブジェクト名" の [追加] をクリックする  
        1. "サブジェクト名" として "CN=WinSrv2.example.local" が追加されたことを確認する  
        1. "別名" の "種類" で、 "DNS" を選択する  
        1. "別名" の "値" に、"Web1.example.local" を入力する
        1. "別名" の [追加] をクリックする  
        1. "別名" として "DNS Web1.example.local" が追加されたことを確認する  
        1. "別名" の "種類" で、 "IPアドレス(v4)" を選択する  
        1. "別名" の "値" に、"10.X.2.105" を入力する
        1. "別名" の [追加] をクリックする  
        1. "別名" として "IPアドレス(v4) 10.X.2.105" が追加されたことを確認する  

    1. [証明書のプロパティ]ウィンドウの[サブジェクト]タブで、[適用]をクリックする  

    1. [証明書のプロパティ]ウィンドウの[拡張機能]タブをクリックして選択する    
        <kbd>![img](image/17/50.png)</kbd>  

    1. [証明書のプロパティ]ウィンドウの[拡張機能]タブの[キー使用法]の展開ボタンをクリックする      
        <kbd>![img](image/17/51.png)</kbd>  


    1. [証明書のプロパティ]ウィンドウの[拡張機能]タブの[キー使用法]で、以下のパラメータを選択する        

        | 選択されたオプション |     
        | :----- | 
        | デジタル署名 |
        | キーの暗号化 |

        <kbd>![img](image/17/52.png)</kbd>  

        詳細手順:  

        1. "キー使用法" の "利用可能なオプション" で、 "デジタル署名" をクリックして選択する  
        1. "キー使用法" の [追加] をクリックする  
        1. "キー使用法" の "利用可能なオプション" で、 "キーの暗号化" をクリックして選択する  
        1. "キー使用法" の [追加] をクリックする  

    1. [証明書のプロパティ]ウィンドウの[拡張機能]タブの[拡張キー使用法]の展開ボタンをクリックする      
        <kbd>![img](image/17/53.png)</kbd>  

    1. [証明書のプロパティ]ウィンドウの[拡張機能]タブの[拡張キー使用法]で、以下のパラメータを選択する        

        | 選択されたオプション |     
        | :----- | 
        | サーバー認証 |

        詳細手順:  

        1. "拡張キー使用法" の "利用可能なオプション" で、 "サーバー認証" をクリックして選択する   
        1. "拡張キー使用法" の [追加] をクリックする   

        <kbd>![img](image/17/54.png)</kbd>  

    1. [証明書のプロパティ]ウィンドウの[拡張機能]タブで、[適用]をクリックする   

    1. [証明書のプロパティ]ウィンドウの[秘密キー]タブをクリックして選択する    
        <kbd>![img](image/17/55.png)</kbd>  

    1. [証明書のプロパティ]ウィンドウの[秘密キー]タブの[キーのオプション]の展開ボタンをクリックする      
        <kbd>![img](image/17/56.png)</kbd>  
    1. [証明書のプロパティ]ウィンドウの[秘密キー]タブの[キーのオプション]で、以下のパラメータを選択する        

        キーのサイズ: 
        | 2048 |     
        | :----- |  

        - [x] 秘密キーをエクスポート可能にする  
        - [ ] 秘密キーのアーカイブを許可する   
        - [ ] 強力な秘密キーの保護     

        <kbd>![img](image/17/57.png)</kbd>  


    1. [証明書のプロパティ]ウィンドウの[秘密キー]タブの[ハッシュアルゴリズムの選択]の展開ボタンをクリックする      
        <kbd>![img](image/17/58.png)</kbd>  

    1. [証明書のプロパティ]ウィンドウの[秘密キー]タブの[ハッシュアルゴリズムの選択]で、以下のパラメータを選択する   

        ハッシュアルゴリズム: 
        | sha256 |    
        | :----- |  

        <kbd>![img](image/17/59.png)</kbd>  

    1. [証明書のプロパティ]ウィンドウの[ハッシュアルゴリズムの選択]タブで、[適用]をクリックする   

    1. [証明書のプロパティ]ウィンドウで、[OK]をクリックする   

    1. [証明書の登録]ウィンドウの[証明書情報]画面で、[次へ]をクリックする  
        <kbd>![img](image/17/60.png)</kbd> 


    1. [証明書の登録]ウィンドウの[オフライン要求を保存する場所を指定してください]画面で、以下のパラメータを入力する  

        ファイル名: 
        | C:\\Share\\HttpsCert.csr |    
        | :----- |  

        ファイル形式:
        - [x] Base64
        - [ ] バイナリ

        <kbd>![img](image/17/61.png)</kbd> 

    1. [証明書の登録]ウィンドウの[オフライン要求を保存する場所を指定してください]画面で、[完了]をクリックする  

1. 証明書署名要求(CSRファイル)が作成されていることを確認する  
    
    1. "C:\\Share" フォルダを開く  
    1. "HttpsCert.csr" ファイルが保存されていることを確認する  

        <kbd>![img](image/17/62.png)</kbd> 

1. (オプション.省略可) "HttpsCert.csr" ファイルをメモ帳(notepad)で開き、Base64エンコードされた証明書署名要求が記述されていることを確認する 
    <kbd>![img](image/17/63.png)</kbd> 


1. (オプション.省略可) 秘密キーが "C:\\ProgramData\\Microsoft\\Crypto\\RSA\\MachineKeys" フォルダに保存されていることを確認する  
    <kbd>![img](image/17/64.png)</kbd> 





---  

<!--
【補足】
NAPTのconfigがCSR1に残っている場合、WinSrv2からWinSrv1に通信できません。  
これは、戻りのパケットの送信元IPアドレスがNAPT変換されて、WinSrv2の認識とは異なる値になるためです。  

例: DNS Query src 10.X.2.105 dest 10.X.1.104  
    DNS Response src 10.X.2.253 dest 10.X.2.105  

WinSrv2で通信パケット(DNS Response)は受信できていますが、アプリケーションでは正しく処理されません。  
興味のある方は、Wiresharkでパケットキャプチャーしてみてください。  
-->


## 証明書の発行を要求する   

1. HTTPS Webサーバー(WinSrv2)の管理画面に接続する  

1. 証明機関Web登録サービスにアクセスする    

    1. WinSrv2でWebブラウザ(Google Chrome)を起動する  
    1. Webブラウザのアドレス欄に [http:/AD.example.local/certsrv] と入力し、[Enter]キーを押下する  
    1. 証明機関Web登録サービスにアクセスしたことを確認する 

        kbd>![img](image/17/71.png)</kbd> 

1. 証明機関Web登録サービスで、証明書の発行を要求する  
    1. [証明書を要求する]をクリックする  
    1. [証明書の要求の詳細設定]をクリックする  
    1. [証明書の要求または更新要求の送信]ページで、以下のパラメータを入力する  
        
        保存された要求:  
        | <"C:\\Share\\HttpsCert.csr"ファイルの中身の文字列全文を貼り付ける> |    
        | :----- |  

        追加属性:  
        | <空欄> |    
        | :----- |  


        手順:
        1. メモ帳(notepad)を起動し、"C:\\Share\\HttpsCert.csr" ファイルを開く
        1. 先頭の"-----BEGIN NEW CERTIFICATE REQUEST-----"行から、末尾の"-----END NEW CERTIFICATE REQUEST-----"行までの全文をコピーする  
        1. Webページのフォームに貼りつける  

        kbd>![img](image/17/72.png)</kbd> 

    1. [証明書の要求または更新要求の送信]ページで、[送信>]をクリックする  
    1. [保留中の証明書]ページで、"要求ID" の数字を確認する  

        kbd>![img](image/17/73.png)</kbd> 

        > 【補足】  
        > 画像例の場合、要求IDは2です。  
        > この要求IDの数字は、次手順の証明書発行操作の際に必要です。  




## 証明書要求を承認し、証明書を発行する   


1. Windows 認証局(WinSrv1)の管理画面に接続する   


1. 証明機関管理コンソールを起動する     
    1. サーバーマネージャーウィンドウ右上の[ツール]をクリックする  
    1. メニュー内の[証明機関]をクリックし、証明機関管理コンソールを起動する  
    1. [証明機関]管理コンソールが起動したことを確認する

1. 証明書の要求を承認する  
    1. 左側コンソールツリーの[証明機関]-[WinCA]-[保留中の要求]をクリックして選択する  
        kbd>![img](image/17/74.png)</kbd> 
    1. 右側ペインの証明書の要求の一覧から、前の操作(証明機関Web登録サービスで、証明書の発行を要求する)で送信された要求をクリックして選択する  
        
        > 【補足】
        > 要求IDの数字を参照し、前の作業で表示されたIDと合致するものを選択する  
    
    1. 該当する要求を右クリックし、コンテキストメニュー内の[すべてのタスク]-[発行]をクリックする  
        kbd>![img](image/17/75.png)</kbd> 
        kbd>![img](image/17/76.png)</kbd> 

1. 証明書が発行されたことを確認する    
    1. 左側コンソールツリーの[証明機関]-[WinCA]-[発行した証明書]をクリックして選択する  
        kbd>![img](image/17/77.png)</kbd> 

    1. 右側ペインの発行した証明書の一覧から、前の操作(証明機関Web登録サービスで証明書の発行を要求する)で送信された要求をクリックして選択する  
        
        > 【補足】
        > 要求IDの数字を参照し、前の作業で表示されたIDと合致するものを選択する  
    
    1. 該当する要求を右クリックし、コンテキストメニュー内の[開く]をクリックする  
        kbd>![img](image/17/78.png)</kbd> 
    
    1. [証明書]ウィンドウが表示されたことを確認する  
    1. [証明書]ウィンドウの[全般]タブのパラメータを確認する    

        > 【確認ポイント】
        > - [x] 発行先が "WinSrv2.example.local" であること  
        > - [x] 発行者が "WinCA" であること  
        > - [x] 現在の日付と時刻が、有効期間の範囲内であること  

        kbd>![img](image/17/79.png)</kbd> 

    1. [証明書]ウィンドウの[全般]タブで、[OK]をクリックする      




## 発行された証明書をダウンロードする  


1. HTTPS Webサーバー(WinSrv2)の管理画面に接続する  

1. 証明機関Web登録サービスにアクセスする    

    1. WinSrv2でWebブラウザ(Google Chrome)を起動する  
    1. Webブラウザのアドレス欄に [http:/AD.example.local/certsrv] と入力し、[Enter]キーを押下する  
    1. 証明機関Web登録サービスにアクセスしたことを確認する  
        kbd>![img](image/17/71.png)</kbd> 

1. 証明書をファイルとしてダウンロードする  
    1. [保留中の証明書の要求の状態]をクリックする  
    1. [保留中の証明書の要求の状態]ページで、[保存された要求証明書]をクリックする  
    1. [証明書は発行されました]ページで、以下のパラメータを選択する  

        - [ ] DERエンコード  
        - [x] Base64エンコード   
        
        kbd>![img](image/17/82.png)</kbd> 

    1. [証明書は発行されました]ページで、[証明書のダウンロード]をクリックする  
    1. ファイルのダウンロードが完了するまで待機する    
    1. ダウンロードフォルダ(C:\\Users\\admin\\Downloads)を開き、"certnew.cer" ファイルが保存されていることを確認する  
        kbd>![img](image/17/83.png)</kbd> 







@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@





---

## 演習完了  
ここまでの手順で、以下の項目を学習できました。
- [x] Webサーバー(IIS)の役割を追加する
- [x] Webコンテンツを公開する
- [x] HTMLファイルを作成する
- [x] 複数のWebサイトをホストする
- [x] ディレクトリ参照を構成する
- [x] エラーページを変更する
- [x] HTTPリダイレクトを構成する
- [x] 基本認証を構成する



## 参考資料
- Apple storeの「まもなくです」は、実は「503」エラーである
    - https://claypier.com/apple-store-coming_soon-503/

